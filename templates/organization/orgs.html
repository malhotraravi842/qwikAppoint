{% extends 'base.html' %}
{% block content %}
<div class="row">
    <h1 class="text-center alert alert-info">Hello from Organization!</h1>
    <div class="col-sm-12">
        <form id="search-bar" class="d-flex mt-5 mb-5">
            <input id="search_here" class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
            <button class="btn btn-info" type="submit">Search</button>
        </form>
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th scope="col">Full Name</th>
                    <th scope="col">Contact</th>
                    <th scope="col">Address</th>
                    <th scope="col">Action</th>
                </tr>
            </thead>
            <tbody id="tablebox">
                {% if object_list %}
                {% for item in object_list %}
                {% if item.type == 'org' %}
                <tr>
                    <th scope="row">{{ item.full_name }}</th>
                    <td>{{ item.contact }}</td>
                    <td>{{ item.address }}</td>
                    <td><a class="btn btn-danger btn-sm" href="{% url 'appointment' item.user_id %}">Take
                            Appointment</a></td>
                </tr>
                {% endif %}
                {% endfor %}
                {% else %}
                <tr>
                    No Organizations to show :(
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>
{% endblock content %}

{% block scripts %}
<script>
    const data = '{{query_json}}';
    const rdata = JSON.parse(data.replace(/&quot;/g, '"'));
    const input = document.getElementById('search_here');
    const box = document.getElementById('tablebox');
    let filteredArr = []
    input.addEventListener("input", (e) => {
        box.innerHTML = "";
        filteredArr = rdata.filter(info => info['full_name'].toLowerCase().includes(e.target.value.toLowerCase()));
        if (filteredArr.length > 0) {
            filteredArr.map(item => {
                if (item['type'] === 'org') {

                    box.innerHTML += `
                    <tr>
                        <th scope="row">${item.full_name}</th>
                        <td>${item.user_id}</td>
                        <td>${item.contact}</td>
                        <td>${item.address}</td>
                        <td><a class="btn btn-danger btn-sm" href="http://127.0.0.1:8000/organization/appointment/${item.user_id}">Take Appointment</a></td>
                    </tr>`;
                }
            })
        } else {
            box.innerHTML = `<tr>
                    <td>
                        No Organizations to show :(
                    </td>
                </tr>`;
        }
    })
</script>

{% endblock scripts %}